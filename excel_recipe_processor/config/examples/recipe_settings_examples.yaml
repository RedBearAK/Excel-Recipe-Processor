# Revision date: 2025-07-30

description: "Recipe settings section configuration options for stage-based architecture with variables and stage management"

minimal_example:
  description: "Minimal required settings section - every recipe should have this"
  yaml: |
    # Minimal settings section - required for all recipes
    
    settings:
      description: "Process daily sales data for regional reporting"

recommended_example:
  description: "Recommended settings with commonly used features"
  yaml: |
    # Recommended settings with stage declarations and variables
    
    settings:
      description: "Process customer orders with data validation and regional analysis"
      
      # Custom variables for reuse throughout recipe
      variables:
        region: "west"
        min_order_amount: "500"
        output_prefix: "processed"
      
      # Stage declarations for auto-completion and protection
      stages:
        - stage_name: "raw_orders"
          description: "Raw order data from import"
          protected: false
        - stage_name: "validated_orders"
          description: "Orders passing validation rules"
          protected: false
        - stage_name: "regional_orders"
          description: "Orders filtered for specific region"
          protected: false

advanced_example:
  description: "Advanced settings with external variables and stage protection"
  yaml: |
    # Advanced settings with external variables and protected stages
    
    settings:
      description: "Batch processing with interactive variable prompting and data protection"
      
      # External variables for CLI automation and interactive prompting
      required_external_vars:
        batch_id:
          description: "Batch identifier for processing"
          validation: "^[A-Z]\\d+$"
          example: "A47, B23, C91"
          # No default - user must provide this
        
        processing_date:
          description: "Date for batch processing (YYYYMMDD format)"
          validation: "^\\d{8}$"
          default_value: "{date}"  # Dynamic default using current date
          example: "20250729"
        
        region:
          description: "Processing region"
          choices: ["west", "east", "central", "all"]
          default_value: "west"
        
        threshold:
          description: "Minimum value threshold for filtering"
          validation: "^\\d+$"
          default_value: "1000"
          allow_empty: false
      
      # Recipe variables for internal use
      variables:
        output_prefix: "batch_report"
        version: "v2.1"
        department: "sales"
      
      # Stage declarations with protection
      stages:
        - stage_name: "master_data"
          description: "Critical master data - do not overwrite accidentally"
          protected: true  # Prevents accidental overwriting
        - stage_name: "batch_data"
          description: "Raw batch data from import"
          protected: false
        - stage_name: "validated_data"
          description: "Data passing all validation rules"
          protected: false
        - stage_name: "final_results"
          description: "Final processed results ready for export"
          protected: false
      
      # Global processing options
      create_backup: true
      encoding: "utf-8"

external_variables_example:
  description: "Comprehensive external variable configuration options"
  yaml: |
    # External variables with all configuration options
    
    settings:
      description: "Demonstrate all external variable features"
      
      required_external_vars:
        # Required variable with validation
        batch_id:
          description: "Unique batch identifier for processing"
          validation: "^[A-Z]\\d+$"
          example: "A47, B23, C91"
          # No default_value means this is truly required
        
        # Variable with choices constraint
        environment:
          description: "Processing environment"
          choices: ["development", "staging", "production"]
          default_value: "development"
        
        # Variable with dynamic default
        report_date:
          description: "Report generation date"
          default_value: "{date}"  # Uses current date
          validation: "^\\d{8}$"
          example: "20250729"
        
        # Optional variable that can be empty
        notes:
          description: "Optional processing notes"
          default_value: ""
          allow_empty: true
          example: "Special handling required, Holiday processing"
        
        # Variable with complex validation
        email_list:
          description: "Comma-separated email addresses for notifications"
          validation: "^[\\w\\._%+-]+@[\\w\\.-]+\\.[A-Z]{2,}(,\\s*[\\w\\._%+-]+@[\\w\\.-]+\\.[A-Z]{2,})*$"
          example: "admin@company.com, manager@company.com"
          default_value: "admin@company.com"

stage_management_example:
  description: "Stage declarations with protection and organization"
  yaml: |
    # Stage management with protection and organization
    
    settings:
      description: "Complex workflow with protected stages and clear organization"
      
      stages:
        # Critical data sources - protected
        - stage_name: "customer_master"
          description: "Master customer data - critical reference"
          protected: true
        - stage_name: "product_catalog"
          description: "Product catalog - protected reference data"
          protected: true
        
        # Processing stages - not protected
        - stage_name: "raw_transactions"
          description: "Raw transaction data from daily import"
          protected: false
        - stage_name: "validated_transactions"
          description: "Transactions passing validation rules"
          protected: false
        - stage_name: "enriched_transactions"
          description: "Transactions with customer and product details added"
          protected: false
        
        # Analysis stages
        - stage_name: "regional_summary"
          description: "Transactions summarized by region"
          protected: false
        - stage_name: "product_performance"
          description: "Product performance metrics"
          protected: false
        
        # Final outputs
        - stage_name: "executive_dashboard"
          description: "Executive summary data"
          protected: false

migration_example:
  description: "Example showing migration from old format to new format"
  yaml: |
    # NEW FORMAT - Stage-based architecture with proper settings
    
    settings:
      description: "Migrated recipe showing new stage-based approach"
      
      variables:
        region: "west"
        output_prefix: "processed"
      
      stages:
        - stage_name: "imported_data"
          description: "Data from import step"
          protected: false
        - stage_name: "processed_data"
          description: "Final processed results"
          protected: false
      
      # DEPRECATED - Remove these when migrating
      # output_filename: "results_{date}.xlsx"  # Use export_file processor instead
    
    recipe:
      # NEW: Explicit import step
      - step_description: "Import source data"
        processor_type: "import_file"
        input_file: "data/{region}_data.xlsx"
        save_to_stage: "imported_data"
      
      # Processing step with explicit stage flow
      - step_description: "Filter and process data"
        processor_type: "filter_data"
        source_stage: "imported_data"
        save_to_stage: "processed_data"
        filters:
          - column: "Status"
            condition: "equals"
            value: "Active"
      
      # NEW: Explicit export step
      - step_description: "Export processed results"
        processor_type: "export_file"
        source_stage: "processed_data"
        output_file: "{output_prefix}_{region}_{date}.xlsx"

parameter_details:
  description:
    type: string
    required: true
    description: "Brief description of what this recipe does"
    purpose: "Documents recipe purpose for team collaboration and maintenance"
    examples:
      - "Process daily sales transactions with regional filtering"
      - "Generate monthly customer report with trend analysis"
      - "Batch process orders with validation and enrichment"
  
  variables:
    type: object
    required: false
    description: "Custom variables for reuse throughout recipe"
    usage: "Referenced using {variable_name} syntax in processor parameters"
    examples:
      region: "west"
      threshold: "1000"
      output_prefix: "processed"
  
  required_external_vars:
    type: object
    required: false
    description: "Variables that can be provided via CLI or interactive prompting"
    benefits: ["CLI automation", "Interactive prompting", "Dynamic processing"]
    
    variable_config:
      description:
        type: string
        required: true
        description: "Human-readable description shown during prompting"
      
      validation:
        type: string
        required: false
        description: "Regular expression pattern for value validation"
        examples: ["^[A-Z]\\d+$", "^\\d{8}$", "^[\\w\\.-]+@[\\w\\.-]+\\.[A-Z]{2,}$"]
      
      choices:
        type: array
        required: false
        description: "List of valid choices (mutually exclusive with validation)"
        examples: [["west", "east", "central"], ["development", "staging", "production"]]
      
      default_value:
        type: string
        required: false
        description: "Default value (supports variable substitution)"
        examples: ["west", "{date}", "admin@company.com"]
      
      example:
        type: string
        required: false
        description: "Example value shown to user during prompting"
      
      allow_empty:
        type: boolean
        required: false
        default: true
        description: "Whether empty values are allowed"
  
  stages:
    type: array
    required: false
    description: "Stage declarations for auto-completion and protection"
    benefits: ["Auto-completion in editors", "Prevents accidental overwrites", "Workflow documentation"]
    
    stage_config:
      stage_name:
        type: string
        required: true
        description: "Unique name for the stage"
        naming_tips: ["Use descriptive names", "Consider stage lifecycle", "Be consistent across recipes"]
      
      description:
        type: string
        required: false
        description: "Human-readable description of stage contents"
        purpose: "Team collaboration and workflow documentation"
      
      protected:
        type: boolean
        required: false
        default: false
        description: "Whether stage is protected from accidental overwriting"
        use_cases: ["Master data", "Critical references", "Expensive computations"]

best_practices:
  settings_first: "Always place settings section before recipe section for discoverability"
  always_describe: "Include description in every recipe for team collaboration"
  declare_stages: "Declare stages for auto-completion and protection features"
  use_variables: "Use variables for repeated values and dynamic content"
  external_vars: "Use external variables for CLI automation and interactive prompting"
  protect_critical: "Mark critical stages as protected to prevent accidental overwrite"
  consistent_naming: "Use consistent naming conventions for stages across recipes"

common_patterns:
  simple_processing: "description + basic variables + stage declarations"
  batch_automation: "description + external variables + stage protection"
  team_recipes: "description + comprehensive stage declarations + protection"
  development_recipes: "description + external variables for environment switching"
  production_recipes: "description + protected stages + comprehensive validation"
